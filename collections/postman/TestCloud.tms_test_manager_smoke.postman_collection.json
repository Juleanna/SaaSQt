{
  "info": {
    "name": "TestCloud TMS - Test Manager Smoke",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "6f9d2b5a-d9b8-4d7b-9e3b-0000000000TM"
  },
  "item": [
    {
      "name": "TMS: Create Release",
      "request": {
        "method": "POST",
        "header": [
          {"key":"Content-Type","value":"application/json"},
          {"key":"Authorization","value":"Bearer {{access}}"},
          {"key":"X-Tenant-ID","value":"{{tenant_id}}"}
        ],
        "body": {"mode":"raw","raw":"{\n  \"project\": {{project_id}},\n  \"name\": \"R1\",\n  \"version\": \"1.0.0\"\n}"},
        "url": "{{base}}/tms/api/releases/"
      },
      "event": [
        {"listen":"test","script":{"type":"text/javascript","exec":[
          "try { var d = pm.response.json(); if (d && d.id) pm.environment.set('release_id', d.id); } catch(e) {}"
        ]}}
      ]
    },
    {
      "name": "TMS: Create Test Plan",
      "request": {
        "method": "POST",
        "header": [
          {"key":"Content-Type","value":"application/json"},
          {"key":"Authorization","value":"Bearer {{access}}"},
          {"key":"X-Tenant-ID","value":"{{tenant_id}}"}
        ],
        "body": {"mode":"raw","raw":"{\n  \"project\": {{project_id}},\n  \"name\": \"Smoke Plan\",\n  \"description\": \"E2E smoke plan\",\n  \"release\": {{release_id}}\n}"},
        "url": "{{base}}/tms/api/plans/"
      },
      "event": [
        {"listen":"test","script":{"type":"text/javascript","exec":[
          "try { var d = pm.response.json(); if (d && d.id) pm.environment.set('plan_id', d.id); } catch(e) {}"
        ]}}
      ]
    },
    {
      "name": "TMS: Add Plan Item (snapshot)",
      "request": {
        "method": "POST",
        "header": [
          {"key":"Content-Type","value":"application/json"},
          {"key":"Authorization","value":"Bearer {{access}}"},
          {"key":"X-Tenant-ID","value":"{{tenant_id}}"}
        ],
        "body": {"mode":"raw","raw":"{\n  \"plan\": {{plan_id}},\n  \"testcase\": {{testcase_id}}\n}"},
        "url": "{{base}}/tms/api/plan-items/"
      },
      "event": [
        {"listen":"test","script":{"type":"text/javascript","exec":[
          "try { var d = pm.response.json(); if (d && d.id) pm.environment.set('plan_item_id', d.id); } catch(e) {}"
        ]}}
      ]
    },
    {
      "name": "TMS: Create Test Run",
      "request": {
        "method": "POST",
        "header": [
          {"key":"Content-Type","value":"application/json"},
          {"key":"Authorization","value":"Bearer {{access}}"},
          {"key":"X-Tenant-ID","value":"{{tenant_id}}"}
        ],
        "body": {"mode":"raw","raw":"{\n  \"project\": {{project_id}},\n  \"plan\": {{plan_id}},\n  \"name\": \"Smoke Run\"\n}"},
        "url": "{{base}}/tms/api/runs/"
      },
      "event": [
        {"listen":"test","script":{"type":"text/javascript","exec":[
          "try { var d = pm.response.json(); if (d && d.id) pm.environment.set('run_id', d.id); } catch(e) {}"
        ]}}
      ]
    },
    {
      "name": "TMS: Start Run (generate instances)",
      "request": {
        "method": "POST",
        "header": [
          {"key":"Authorization","value":"Bearer {{access}}"},
          {"key":"X-Tenant-ID","value":"{{tenant_id}}"}
        ],
        "url": "{{base}}/tms/api/runs/{{run_id}}/start/"
      }
    },
    {
      "name": "TMS: List Instances",
      "request": {
        "method": "GET",
        "header": [
          {"key":"Authorization","value":"Bearer {{access}}"},
          {"key":"X-Tenant-ID","value":"{{tenant_id}}"}
        ],
        "url": "{{base}}/tms/api/instances/?run={{run_id}}"
      },
      "event": [
        {"listen":"test","script":{"type":"text/javascript","exec":[
          "try { var d = pm.response.json(); var first = (d && d.results && d.results[0]) || (Array.isArray(d) && d[0]); if (first && first.id) pm.environment.set('instance_id', first.id); } catch(e) {}"
        ]}}
      ]
    },
    {
      "name": "TMS: Pass first instance",
      "request": {
        "method": "POST",
        "header": [
          {"key":"Authorization","value":"Bearer {{access}}"},
          {"key":"X-Tenant-ID","value":"{{tenant_id}}"}
        ],
        "url": "{{base}}/tms/api/instances/{{instance_id}}/pass_case/"
      }
    },
    {
      "name": "TMS: Finish Run",
      "request": {
        "method": "POST",
        "header": [
          {"key":"Authorization","value":"Bearer {{access}}"},
          {"key":"X-Tenant-ID","value":"{{tenant_id}}"}
        ],
        "url": "{{base}}/tms/api/runs/{{run_id}}/finish/"
      }
    }
  ]
}

